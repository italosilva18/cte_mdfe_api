<!DOCTYPE html>
{% load static %}
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Sistema de Gestão de Transporte{% endblock %} - Destack Transportes</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    
     <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Chart.js -->
    <link href="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.css" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link href="{% static 'css/styles.css' %}" rel="stylesheet">
    
    <!-- Custom CSS for specific pages -->
    {% block extra_css %}{% endblock %}
</head>
<body>
    <!-- Mobile Menu Toggle Button -->
    <button class="menu-toggle btn btn-sm" title="Toggle menu">
        <i class="fas fa-bars"></i>
    </button>

    <div class="wrapper">
        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <img src="{% static 'img/logo.svg' %}" alt="Destack Transportes" class="sidebar-logo">
                <h5 class="sidebar-title">Gestão de Transporte</h5>
            </div>
            
            <ul class="nav flex-column mt-3">
                <li class="nav-item">
                    <a class="nav-link {% if request.path == '/dashboard/' %}active{% endif %}" href="{% url 'dashboard' %}">
                        <i class="fas fa-tachometer-alt"></i>
                        <span class="nav-text">Dashboard</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link {% if request.path == '/cte/' %}active{% endif %}" href="{% url 'cte_panel' %}">
                        <i class="fas fa-file-invoice"></i>
                        <span class="nav-text">CT-e</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link {% if request.path == '/mdfe/' %}active{% endif %}" href="{% url 'mdfe_panel' %}">
                        <i class="fas fa-truck"></i>
                        <span class="nav-text">MDF-e</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link {% if request.path == '/upload/' %}active{% endif %}" href="{% url 'upload' %}">
                        <i class="fas fa-file-import"></i>
                        <span class="nav-text">Importar XML</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link {% if request.path == '/financeiro/' %}active{% endif %}" href="{% url 'financeiro' %}">
                        <i class="fas fa-chart-line"></i>
                        <span class="nav-text">Financeiro</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link {% if request.path == '/geografico/' %}active{% endif %}" href="{% url 'geografico' %}">
                        <i class="fas fa-map-marked-alt"></i>
                        <span class="nav-text">Geográfico</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link {% if request.path == '/manutencao/' %}active{% endif %}" href="{% url 'manutencao' %}">
                        <i class="fas fa-tools"></i>
                        <span class="nav-text">Manutenção</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link {% if request.path == '/configuracoes/' %}active{% endif %}" href="{% url 'configuracoes' %}">
                        <i class="fas fa-cog"></i>
                        <span class="nav-text">Configurações</span>
                    </a>
                </li>
            </ul>
            
            <div class="sidebar-footer">
                <div class="user-info">
                    <div class="user-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div>
                        <div class="user-name">{{ request.user.get_full_name|default:request.user.username }}</div>
                        <div class="user-role">
                            {% if request.user.is_superuser %}
                            Administrador
                            {% else %}
                            Usuário
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <div class="d-flex justify-content-between">
                    <button id="themeToggle" class="btn btn-sm btn-outline-light" title="Alternar Tema">
                        <i id="themeIcon" class="fas fa-moon"></i>
                    </button>
                    
                    <button id="sidebarToggle" class="btn btn-sm btn-outline-light" title="Recolher Menu">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    
                    <a href="{% url 'logout' %}" class="btn btn-sm btn-outline-light" id="logoutBtn" title="Sair do Sistema">
                        <i class="fas fa-sign-out-alt"></i>
                    </a>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Page Header -->
            <div class="page-header">
                <div>
                    <h1 class="page-title">{% block header %}Dashboard{% endblock %}</h1>
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="{% url 'home' %}">Início</a></li>
                            {% block breadcrumbs %}{% endblock %}
                        </ol>
                    </nav>
                </div>
                
                <div>
                    {% block page_actions %}{% endblock %}
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="container-fluid p-0">
                {% block content %}{% endblock %}
            </div>
            
            <!-- Footer -->
            <footer class="footer mt-auto py-3">
                <div class="container-fluid">
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="text-muted">© {% now "Y" %} Destack Transportes. Todos os direitos reservados.</span>
                        <span class="text-muted">Versão 1.0.0</span>
                    </div>
                </div>
            </footer>
        </div>
    </div>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>
    
    <!-- Global JS -->
    <script src="{% static 'js/auth.js' %}"></script>
    <script src="{% static 'js/scripts.js' %}"></script>
    
    <!-- Page Specific Scripts -->
    {% block scripts %}{% endblock %}
    
    <script>
        // Initialize sidebar toggle
        document.getElementById('sidebarToggle').addEventListener('click', function() {
            document.querySelector('.sidebar').classList.toggle('collapsed');
            document.querySelector('.main-content').classList.toggle('expanded');
            
            // Change icon direction
            const icon = this.querySelector('i');
            if (icon.classList.contains('fa-chevron-left')) {
                icon.classList.remove('fa-chevron-left');
                icon.classList.add('fa-chevron-right');
            } else {
                icon.classList.remove('fa-chevron-right');
                icon.classList.add('fa-chevron-left');
            }
        });
    </script>
</body>
</html>